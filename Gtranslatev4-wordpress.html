<style>
.gtranslate_wrapper {
    position: fixed;
    bottom: 17px;
    right: 20px;
    z-index: 1000;
}
.gtranslate_wrapper a {
    padding: 10px 15px;
    border-radius: 5px;
    text-decoration: none;
    display: inline-block;
}
.VIpgJd-ZVi9od-aZ2wEe-wOHMyf {
   display: none !important;
}
.VIpgJd-ZVi9od-aZ2wEe-OiiCO {
   display: none !important;
}
.goog-te-spinner {  
    display: none !important;
}
</style>

<!-- Configuration Script - IMPORTANT: Keep this LAST -->
<script>
window.gtranslateSettings = {
    "default_language": "de",
    "languages": ["de", "en", "el"],
    "wrapper_selector": ".gtranslate_wrapper",
    "switcher_horizontal_position": "inline",
    "detect_browser_language": false,
    "alt_flags":{"en":"usa"}
};

</script>

<!-- Translator container -->
<div class="gtranslate_wrapper"></div>

<script>
// Advanced Persistent GTranslate Language Tracking
(function() {
    // Configuration
    const CONFIG = {
        DEFAULT_LANGUAGE: 'de',
        SUPPORTED_LANGUAGES: ['de', 'en', 'el'],
        STORAGE_KEY: 'gTranslateLanguageState',
        COOKIE_EXPIRY_DAYS: 30
    };

    // Comprehensive Logging
    function safeLog(message) {
        try {
            // console.log('[GTranslate Persistent Tracker]:', message);
        } catch (e) {
            // Fallback logging
            alert(message);
        }
    }

    // Cookie Management Utility
    const CookieManager = {
        set: function(name, value, days) {
            const date = new Date();
            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
            const expires = "expires=" + date.toUTCString();
            document.cookie = `${name}=${value};${expires};path=/;SameSite=Strict`;
        },
        get: function(name) {
            const cookieName = name + "=";
            const decodedCookie = decodeURIComponent(document.cookie);
            const cookieArray = decodedCookie.split(';');
            for(let i = 0; i < cookieArray.length; i++) {
                let cookie = cookieArray[i];
                while (cookie.charAt(0) === ' ') {
                    cookie = cookie.substring(1);
                }
                if (cookie.indexOf(cookieName) === 0) {
                    return cookie.substring(cookieName.length, cookie.length);
                }
            }
            return null;
        }
    };

    // Comprehensive Language Detection
    function detectCurrentLanguage() {
        document.querySelectorAll('.widgets-time-slot').forEach(element => {  
    		element.classList.add('notranslate');
	    });
        // Check multiple sources with priority
        const sources = [
            // 1. URL Parameter
            () => {
                const urlParams = new URLSearchParams(window.location.search);
                const urlLang = urlParams.get('lang');
		        const gtranslateSelect = document.querySelector('.gt-options');  
                if (gtranslateSelect) {  
                    const event = new Event('click', { bubbles: true });  
                    gtranslateSelect.dispatchEvent(event);  
                } else {  
                    // console.error('GTranslate select element not found!');  
                }
                if (urlLang && CONFIG.SUPPORTED_LANGUAGES.includes(urlLang)) {
                    safeLog('Language from URL: ' + urlLang);
                    return urlLang;
                }
                return null;
            },
            
            // 2. Cookies
            () => {
                const cookieLang = CookieManager.get(CONFIG.STORAGE_KEY);
                if (cookieLang && CONFIG.SUPPORTED_LANGUAGES.includes(cookieLang)) {
                    safeLog('Language from Cookie: ' + cookieLang);
                    return cookieLang;
                }
                return null;
            },
            
            // 3. Local Storage
            () => {
                const storedLang = localStorage.getItem(CONFIG.STORAGE_KEY);
                if (storedLang && CONFIG.SUPPORTED_LANGUAGES.includes(storedLang)) {
                    safeLog('Language from localStorage: ' + storedLang);
                    return storedLang;
                }
                return null;
            },
            
            // 4. Fallback to default
            () => {
                safeLog('Falling back to default language: ' + CONFIG.DEFAULT_LANGUAGE);
                return CONFIG.DEFAULT_LANGUAGE;
            }
        ];

        // Find first valid language source
        for (let source of sources) {
            const lang = source();
            if (lang) return lang;
        }
    }

    
    // Initialize Language Tracking
    function initLanguageTracking() {
    document.querySelectorAll('.widgets-time-slot').forEach(element => {  
    		element.classList.add('notranslate');
	});
        safeLog('Initializing Persistent Language Tracking');

    // Detect and set initial language
    const initialLang = detectCurrentLanguage();
    // Periodic language change detection
    let lastLang = initialLang;
    setInterval(() => {
        try {

            if (document.getElementById("uicore-back-to-top").classList.contains('uicore-visible')) {
    document.getElementsByClassName("gtranslate_wrapper")[0].style.right = '80px';
    
} else {
    document.getElementsByClassName("gtranslate_wrapper")[0].style.right = '20px';
}
            const langCodeSpans = document.getElementsByClassName('gt-lang-code');  
            const langcontent = langCodeSpans.length > 0 ? langCodeSpans[0].textContent : null; 
            const currentLang = langcontent || initialLang;
            document.querySelectorAll('.video-de').forEach(element => {  
    		    element.style.display = 'none';  
	        });
	        document.querySelectorAll('.video-en').forEach(element => {  
    	    	element.style.display = 'none';
	        });
	        document.querySelectorAll('.video-el').forEach(element => {  
    		    element.style.display = 'none';
	        });
            if(currentLang == 'de') {
                document.querySelectorAll('.video-de').forEach(element => {  
    		        element.style.display = 'flex';  
	            });
	        } else if(currentLang == 'en') {
       	        document.querySelectorAll('.video-en').forEach(element => {  
    		        element.style.display = 'flex';  
	            });
	        } else if(currentLang == 'el') {
		        document.querySelectorAll('.video-el').forEach(element => {  
    		    element.style.display = 'flex';
	        });
        }
        if (currentLang !== lastLang) {
            document.querySelectorAll('.video-en').forEach(div => {
  			    const iframe = div.querySelector('iframe');
  		    	var src = iframe.src;
  			    iframe.src = src;
		    });
            document.querySelectorAll('.video-de').forEach(div => {
  			    const iframe = div.querySelector('iframe');
  			    var src = iframe.src;
  			    iframe.src = src;
		    });
            document.querySelectorAll('.video-el').forEach(div => {
  		    	const iframe = div.querySelector('iframe');
  		    	var src = iframe.src;
  		    	iframe.src = src;
		    });
            safeLog('Language change detected: ' + currentLang);
            lastLang = currentLang;
        }
        } catch (error) {
            safeLog('Tracking error: ' + error.message);
        }
        }, 500);
    }

    // Ensure script runs after page load
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initLanguageTracking);
    } else {
        initLanguageTracking();
    }

})();
</script>

<!-- Translator script - IMPORTANT: Keep this AFTER our tracking script -->
<script src="https://cdn.gtranslate.net/widgets/latest/float.js" defer></script>

